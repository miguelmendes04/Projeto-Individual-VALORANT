<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escolha seu agente</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="imagens/valorant-favicon.png" />
  </head>
  <body style="background-image: url('imagens/range.jpg')">
    <header>
      <div class="container_header">
        <a href="index.html#sobre" class="item_lista">Sobre o jogo</a>
        <a href="index.html" class="icon_val">vALORaNT</a>
        <a href="escolha.html" class="item_lista">vote aqui</a>
      </div>
    </header>
    <div id="confirmacao_voto" class="alert">
      <div class="alert_container">
        <span id="alert_mensagem" class="alert_mensagem">
          Voto cadastrado!
        </span>
      </div>
      <a href="#" id="btn_ok" onclick="fecharPopUp()"> OK </a>
    </div>
    <div class="container_select">
      <div class="select_mapas">
        <label for="mapa_fundo">Escolha um mapa:</label>
        <select id="mapa_fundo">
          <option value="ascent">Ascent</option>
          <option value="bind">Bind</option>
          <option value="breeze">Breeze</option>
          <option value="fracture">Fracture</option>
          <option value="haven">Haven</option>
          <option value="icebox">Icebox</option>
          <option value="range" selected="selected">Range</option>
          <option value="split">Split</option>
        </select>
      </div>
    </div>
    <div class="container_mais_votados">
      <div class="mais_votados">
        <h1>Agentes mais votados:</h1>
        <div class="primeiro_lugar">
          <h2>1º</h2>
          <span id="spanAgente1"></span>
          <span id="qtdVotosAgente1"></span>
        </div>
        <div class="segundo_lugar">
          <h3>2º</h3>
          <span id="spanAgente2"></span><span id="qtdVotosAgente2"></span>
        </div>
        <div class="terceiro_lugar">
          <h3>3º</h3>
          <span id="spanAgente3"></span><span id="qtdVotosAgente3"></span>
        </div>
      </div>
      <div class="mais_votados">
        <h1>Mapas mais votados:</h1>
        <div class="primeiro_lugar">
          <h2>1º</h2>
          <span id="spanMapa1"></span> <span id="qtdVotosMapa1"></span>
        </div>
        <div class="segundo_lugar">
          <h3>2º</h3>
          <span id="spanMapa2"></span> <span id="qtdVotosMapa2"></span>
        </div>
        <div class="terceiro_lugar">
          <h3>3º</h3>
          <span id="spanMapa3"></span> <span id="qtdVotosMapa3"></span>
        </div>
      </div>
    </div>
    <div class="agente_selecionado">
      <img src="" class="img_agente" />
    </div>
    <div class="selecionar_agentes">
      <div class="info_agentes">
        <h1>Agente selecionado: <span id="span_agente_selecionado"></span></h1>
        <h2>ClAsse: <span id="span_classe_selecionada"></span></h2>
        <p id="sobre_o_agente"></p>
      </div>
      <div class="div_agentes">
        <button
          class="agente"
          id="Astra"
          style="
            background-image: url('imagens/astra-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Controlador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Breach"
          style="
            background-image: url('imagens/breach-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Iniciador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Brimstone"
          style="
            background-image: url('imagens/brimstone-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Controlador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Chamber"
          style="
            background-image: url('imagens/chamber-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Sentinela'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Cypher"
          style="
            background-image: url('imagens/cypher-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Sentinela'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Fade"
          style="
            background-image: url('imagens/fade-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Iniciador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Jett"
          style="
            background-image: url('imagens/jett-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Duelista'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Kayo"
          style="
            background-image: url('imagens/kayo-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Iniciador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Killjoy"
          style="
            background-image: url('imagens/killjoy-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Sentinela'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Neon"
          style="
            background-image: url('imagens/neon-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Duelista'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Omen"
          style="
            background-image: url('imagens/omen-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Controlador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Phoenix"
          style="
            background-image: url('imagens/phoenix-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Duelista'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Raze"
          style="
            background-image: url('imagens/raze-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Duelista'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Reyna"
          style="
            background-image: url('imagens/reyna-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Duelista'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Sage"
          style="
            background-image: url('imagens/sage-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Sentinela'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Skye"
          style="
            background-image: url('imagens/skye-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Iniciador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Sova"
          style="
            background-image: url('imagens/sova-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Iniciador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Viper"
          style="
            background-image: url('imagens/viper-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Controlador'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
        <button
          class="agente"
          id="Yoru"
          style="
            background-image: url('imagens/yoru-select.png');
          "
          onclick="alterarNomeAgente(this.id); alterarClasseAgente('Duelista'); alterarImgAgente(`imagens/${this.id}.png`)"
        ></button>
      </div>
      <button class="btn_confirmar" onclick="cadastrar()">Confirmar</button>
    </div>
  </body>
</html>

<script>
  var selectMapas = document.getElementById("mapa_fundo");

  selectMapas.onclick = function () {
    if (this.value == "ascent") {
      document.body.style.backgroundImage = "url('imagens/ascent.jpg')";
    } else if (this.value == "bind") {
      document.body.style.backgroundImage = "url('imagens/bind.jpg')";
    } else if (this.value == "breeze") {
      document.body.style.backgroundImage = "url('imagens/breeze.jpg')";
    } else if (this.value == "fracture") {
      document.body.style.backgroundImage = "url('imagens/fracture.jpg')";
    } else if (this.value == "haven") {
      document.body.style.backgroundImage = "url('imagens/haven.jpg')";
    } else if (this.value == "icebox") {
      document.body.style.backgroundImage = "url('imagens/icebox.jpg')";
    } else if (this.value == "range") {
      document.body.style.backgroundImage = "url('imagens/range.jpg')";
    } else if (this.value == "split") {
      document.body.style.backgroundImage = "url('imagens/split.jpg')";
    }
  };
</script>

<script>
  window.onload = obterdadosAgente(), obterdadosMapa();

  function alterarImgAgente(imagem) {
    document.querySelector(".img_agente").src = imagem;
  }

  function alterarNomeAgente(agente) {
    const agente_selecionado = document.querySelector(
      "#span_agente_selecionado"
    );
    agente_selecionado.innerHTML = agente;
  }

  function alterarClasseAgente(classe) {
    const classe_agente = document.querySelector("#span_classe_selecionada");
    classe_agente.innerHTML = classe;
  }

  function cadastrar() {
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var votoMapaVar = mapa_fundo.value;
    var votoAgenteVar = span_agente_selecionado.innerHTML;

    if (votoAgenteVar == "") {
      alert("Selecione um agente.");
    } else {
      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          votoMapaServer: votoMapaVar,
          votoAgenteServer: votoAgenteVar,
        }),
      });
      document.querySelector(".alert").style.visibility = "visible";
    }
  }

  function obterdadosAgente() {
    fetch(`/medidas/tempo-realAgente/`)
      .then((resposta) => {
        if (resposta.ok) {
          resposta.json().then((resposta) => {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

            for (var i = 0; i < resposta.length; i++) {
              (document.querySelector(`#spanAgente${i + 1}`).innerHTML =
                resposta[i].nomeAgente),
                (document.querySelector(
                  `#qtdVotosAgente${i + 1}`
                ).innerHTML = `${resposta[i].qtdVotos} votos`);
            }
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`
        );
      });
  }

  function obterdadosMapa() {
    fetch(`/medidas/tempo-realMapa/`)
      .then((resposta) => {
        if (resposta.ok) {
          resposta.json().then((resposta) => {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

            for (var i = 0; i < resposta.length; i++) {
              (document.querySelector(`#spanMapa${i + 1}`).innerHTML =
                resposta[i].nomeMapa),
                (document.querySelector(
                  `#qtdVotosMapa${i + 1}`
                ).innerHTML = `${resposta[i].qtdVotos} votos`);
            }
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`
        );
      });
  }

  function fecharPopUp() {
    document.querySelector(".alert").style.visibility = "hidden";
    obterdadosAgente();
    obterdadosMapa();
  }
</script>
